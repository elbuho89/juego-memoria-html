<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Memoria</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the card flip effect */
        .card {
            aspect-ratio: 1 / 1;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
            position: relative;
        }

        .card.flip {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .card-back {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            font-size: 1.5rem;
            transform: rotateY(0deg);
            user-select: none;
        }

        .card-front {
            background-color: #f3f4f6; /* gray-100 */
            color: #1f2937; /* gray-800 */
            font-size: 2.5rem;
            transform: rotateY(180deg);
        }

        /* Style for matched cards (optional visibility/opacity change) */
        .card.match .card-front {
            background-color: #10b981; /* emerald-500 */
            color: white;
        }

        /* Ensure the body and html take full height for centering */
        html, body {
            height: 100%;
            font-family: 'Inter', sans-serif;
        }

        .game-container {
            max-width: 500px;
            width: 95%;
        }

    </style>
    <script>
        // Array of emojis for the cards. We need 8 pairs (16 cards).
        const cardIcons = ['üçî', 'üçï', 'üç©', 'üç¶', 'ü•ù', 'üçâ', 'üçá', 'üçì'];
        let gameBoard = [];
        let flippedCards = [];
        let lockBoard = false;
        let matchesFound = 0;

        const totalPairs = cardIcons.length;
        const totalCards = totalPairs * 2;

        // Se declaran con 'let' y se inicializan a null.
        // Se les asignar√° el elemento DOM real dentro de window.onload
        let mainContainer = null;
        let statusMessage = null;
        let resetButton = null;


        // Function to duplicate and shuffle the icons
        function initializeCards() {
            // Duplicate the icons to create pairs
            let cards = [...cardIcons, ...cardIcons];
            // Fisher-Yates shuffle algorithm
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            return cards;
        }

        // Function to create the HTML for a single card
        function createCardElement(icon, index) {
            const card = document.createElement('div');
            card.classList.add('card', 'rounded-xl', 'transition-transform');
            card.dataset.icon = icon;
            card.dataset.index = index;
            card.innerHTML = `
                <!-- Card Back (Default State) -->
                <div class="card-face card-back shadow-lg hover:shadow-xl transition duration-300">
                    ?
                </div>
                <!-- Card Front (Flipped State) -->
                <div class="card-face card-front font-extrabold shadow-inner">
                    ${icon}
                </div>
            `;
            // Add click listener
            card.addEventListener('click', () => flipCard(card));
            return card;
        }

        // Main function to set up the game board
        function initGame() {
            // Reset game state variables
            gameBoard = initializeCards();
            flippedCards = [];
            lockBoard = false;
            matchesFound = 0;

            // Clear the existing board
            mainContainer.innerHTML = '';
            statusMessage.textContent = 'Encuentra las 8 parejas.';
            statusMessage.classList.remove('text-green-500', 'font-extrabold', 'text-2xl');

            // Populate the board
            gameBoard.forEach((icon, index) => {
                mainContainer.appendChild(createCardElement(icon, index));
            });
            console.log("Juego inicializado con √©xito.");
        }

        // Handle card click (flip logic)
        function flipCard(card) {
            // 1. Check if board is locked or card is already flipped/matched
            if (lockBoard || card.classList.contains('flip') || card.classList.contains('match')) {
                return;
            }

            // 2. Flip the card visually
            card.classList.add('flip');
            flippedCards.push(card);

            // 3. Check for the second card flip
            if (flippedCards.length === 1) {
                // First card flipped, wait for the second
                return;
            }

            // 4. Second card flipped, lock the board temporarily
            lockBoard = true;
            checkForMatch();
        }

        // Check if the two flipped cards match
        function checkForMatch() {
            const [firstCard, secondCard] = flippedCards;
            const isMatch = firstCard.dataset.icon === secondCard.dataset.icon;

            isMatch ? disableCards() : unflipCards();
        }

        // Cards match: mark as matched and unlock board
        function disableCards() {
            const [firstCard, secondCard] = flippedCards;

            firstCard.classList.add('match', 'cursor-default');
            secondCard.classList.add('match', 'cursor-default');

            matchesFound++;
            resetBoard();

            if (matchesFound === totalPairs) {
                winGame();
            }
        }

        // Cards don't match: unflip after a delay
        function unflipCards() {
            setTimeout(() => {
                flippedCards.forEach(card => card.classList.remove('flip'));
                resetBoard();
            }, 1000); // 1 second delay
        }

        // Reset the temporary variables after a turn
        function resetBoard() {
            [flippedCards, lockBoard] = [[], false];
        }

        // Handle the win condition
        function winGame() {
            statusMessage.textContent = '¬°Felicidades! Ganaste el juego. üéâ Reiniciando...';
            statusMessage.classList.add('text-green-500', 'font-extrabold', 'text-2xl');
            
            // Bloquea el tablero y lo reinicia despu√©s de 3 segundos
            lockBoard = true; 
            setTimeout(() => {
                initGame();
            }, 3000); // 3 segundos de espera

            // Tambi√©n deshabilitamos el bot√≥n de Reiniciar temporalmente para evitar interrupciones
            resetButton.disabled = true;
            setTimeout(() => {
                resetButton.disabled = false;
            }, 3000);
        }

        // Initialize the game when the window loads
        window.onload = function() {
            // Se obtienen las referencias a los elementos del DOM aqu√≠,
            // cuando el HTML ya est√° cargado.
            mainContainer = document.getElementById('game-board');
            statusMessage = document.getElementById('status-message');
            resetButton = document.getElementById('reset-button');

            // Set up the reset button listener
            resetButton.addEventListener('click', initGame);
            // Start the first game
            initGame();
        };

    </script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">

    <div class="game-container bg-gray-800 p-6 rounded-2xl shadow-2xl space-y-6">

        <!-- Title and Status -->
        <header class="text-center">
            <h1 class="text-3xl font-bold text-blue-400">Juego de Memoria</h1>
            <p id="status-message" class="mt-2 text-gray-300">Encuentra las 8 parejas.</p>
        </header>

        <!-- Game Board Grid -->
        <main id="game-board" class="grid grid-cols-4 gap-3 md:gap-4"></main>

        <!-- Control Button -->
        <div class="text-center">
            <button id="reset-button"
                    class="bg-pink-600 hover:bg-pink-700 text-white font-semibold py-3 px-6 rounded-full transition duration-300 shadow-md hover:shadow-lg focus:outline-none focus:ring-4 focus:ring-pink-500 focus:ring-opacity-50">
                Reiniciar Juego
            </button>
        </div>

    </div>

</body>
</html>
